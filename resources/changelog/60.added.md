Add garbage collection and try some workarounds to avoid memory leaks